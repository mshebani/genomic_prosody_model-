import streamlit as st
import numpy as np

# Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª Ø§Ù„Ø¬ÙŠÙ†ÙŠØ©
rhythm_map = {
    "A": {"symbol": "|0", "weight": 0.9},
    "U": {"symbol": "0|", "weight": 0.5},
    "C": {"symbol": "||", "weight": 1.2},
    "G": {"symbol": "||0", "weight": 1.4}
}

def analyze_codon(codon):
    symbols = []
    total_weight = 0
    for base in codon:
        base = base.upper()
        if base in rhythm_map:
            symbols.append(rhythm_map[base]["symbol"])
            total_weight += rhythm_map[base]["weight"]
        else:
            symbols.append("ØŸ")
    return symbols, round(total_weight, 2)

def split_sequence(seq):
    return [seq[i:i+3] for i in range(0, len(seq), 3) if len(seq[i:i+3]) == 3]

# ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
st.title("ğŸ§¬ ØªØ­Ù„ÙŠÙ„ Ø¹Ø±ÙˆØ¶ Ø¬ÙŠÙ†ÙŠ Ù„Ø³Ù„Ø³Ù„Ø© RNA ÙƒØ§Ù…Ù„Ø©")
st.write("ÙŠØªÙ… ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø¥Ù„Ù‰ ÙƒÙˆØ¯ÙˆÙ†Ø§Øª ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø¹Ø±ÙˆØ¶ÙŠ Ù„ÙƒÙ„ ÙˆØ§Ø­Ø¯Ø©")

sequence = st.text_area("ğŸ”¤ Ø£Ø¯Ø®Ù„ Ø³Ù„Ø³Ù„Ø© RNA (Ù…Ø«Ø§Ù„: AUGGCUUAAUGA)", "AUGGCUUAAUGA")

if st.button("ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ù„Ø³Ù„Ø©"):
    codons = split_sequence(sequence)
    
    if not codons:
        st.warning("Ø§Ù„Ø³Ù„Ø³Ù„Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø© Ø£Ùˆ Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§.")
    else:
        st.markdown("## ğŸ”¬ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„:")
        total_weight = 0
        rhythm_sequence = []

        for i, codon in enumerate(codons):
            symbols, weight = analyze_codon(codon)
            total_weight += weight
            rhythm_sequence.append({
                "codon": codon,
                "symbols": " - ".join(symbols),
                "weight": weight
            })

        for i, item in enumerate(rhythm_sequence):
            st.markdown(f"""
            ### ğŸ¼ ÙƒÙˆØ¯ÙˆÙ† {i+1} - `{item['codon']}`
            - Ø§Ù„ØªÙØ¹ÙŠÙ„Ø©: `{item['symbols']}`
            - Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø¹Ø±ÙˆØ¶ÙŠ: `{item['weight']}`
            """)

        st.markdown(f"## âš–ï¸ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø¹Ø±ÙˆØ¶ÙŠ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ø³Ù„Ø³Ù„Ø©: `{round(total_weight, 2)}` ğŸ¶")

        st.markdown("---")
        st.subheader("ğŸ§ª ØªØ¬Ø±Ø¨Ø© Ø·ÙØ±Ø© Ø¹Ù„Ù‰ Ø£Ø­Ø¯ Ø§Ù„ÙƒÙˆØ¯ÙˆÙ†Ø§Øª")
        index = st.number_input("ğŸ”¢ Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„ÙƒÙˆØ¯ÙˆÙ† (1 Ø¥Ù„Ù‰ {})".format(len(codons)), min_value=1, max_value=len(codons), step=1)
        new_codon = st.text_input("âœï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ÙˆÙ† Ø§Ù„Ø·Ø§ÙØ± Ø§Ù„Ø¨Ø¯ÙŠÙ„", codons[index-1])

        if len(new_codon) == 3:
            _, original_weight = analyze_codon(codons[index-1])
            symbols, new_weight = analyze_codon(new_codon)
            delta = new_weight - original_weight
            direction = "â¬†ï¸ Ø²ÙŠØ§Ø¯Ø©" if delta > 0 else ("â¬‡ï¸ Ù†Ù‚ØµØ§Ù†" if delta < 0 else "â¸ï¸ Ø«Ø§Ø¨Øª")

            st.markdown(f"""
            ### ğŸ§¬ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·ÙØ±Ø©:
            - Ø§Ù„ÙƒÙˆØ¯ÙˆÙ† Ø§Ù„Ø£ØµÙ„ÙŠ: `{codons[index-1]}` â†’ Ø§Ù„ÙˆØ²Ù†: `{original_weight}`
            - Ø§Ù„ÙƒÙˆØ¯ÙˆÙ† Ø§Ù„Ø·Ø§ÙØ±: `{new_codon}` â†’ Ø§Ù„ÙˆØ²Ù†: `{new_weight}`
            - ğŸ” Ø§Ù„ÙØ±Ù‚: `{round(delta, 2)} ({direction})`
            - Ø§Ù„ØªÙØ¹ÙŠÙ„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: `{symbols}`
            """)
        else:
            st.warning("Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ÙˆÙ† Ø·Ø§ÙØ± Ù…ÙƒÙˆÙ‘Ù† Ù…Ù† 3 Ø­Ø±ÙˆÙ ÙÙ‚Ø·.")
